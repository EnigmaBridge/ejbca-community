<?xml version="1.0" encoding="UTF-8"?>
<project name="build-dependencies" >
	<description>
		<![CDATA[
            This file builds all the internal dependencies of the EJBCA core.

    		To enforce proper dependencies between different core components of the EJBCA core
    		should be able to compile each component with only the current components dependencies
    		in the classpath. To make sure this happens we need to isolate the source files first.
    		
    		New valid dependencies can be added by <include ...>-ing the appropriate source-code
    		for each 'javac' or dependency in the
    			<classpath>
			<pathelement location="${build-temp.dir}/......"/>...</classpath>
    		element. However, please double-check that you do not introduce any new circular or
    		otherwise undesired dependencies.
    		
    		The code below are mainly a temporary help to be able to divide the components into new
    		packages more easily. Ideally each include should only be
    		"org/ejbca/<component>/**/*.java" and each check could be placed in proper reusable
    		sub-targets.

            https://jira.primekey.se/browse/ECA-1495 contains more information.
            ]]>
    </description>

		<property name="build-temp.dir" location="${this.dir}/build-temp"/>
		<property name="src-temp.dir" location="${this.dir}/src-temp"/>

		<!-- External source dirs -->
		<property name="src-ejbca-ejb-interface.dir" location="${this.dir}/../ejbca-ejb-interface/src"/>
		<property name="src-ejbca-entity.dir" location="${this.dir}/../ejbca-entity/src"/>

		<target name="dependecy-check-clean" description="Clean up dependency check on the different EJBCA core components">
			<delete dir="${src-temp.dir}" />
			<delete dir="${build-temp.dir}" />
		</target>

		<target name="dependecy-check" unless="no-depcheck" description="Perform a dependency check on the different EJBCA core components.">
			<echo message="This check can be disabled by running ant with '-Dno-depcheck=1'"/>
			<mkdir dir="${src-temp.dir}"/>
			<mkdir dir="${build-temp.dir}"/>

			<!-- Basic configuration, utils and constants component -->
			<echo message=" ** Validating component: Basics **"/>
			<mkdir dir="${src-temp.dir}/common"/>
			<mkdir dir="${build-temp.dir}/common"/>
			<copy todir="${src-temp.dir}/common">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/cesecore/jndi/JndiHelper.java"/>
					<include name="org/cesecore/jndi/JndiConstants.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/cesecore/dbprotection/*.java"/>					
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/cesecore/CesecoreException.java"/>
					<include name="org/cesecore/ErrorCode.java"/>				
					<include name="org/cesecore/authorization/control/AuditLogRules.java"/>
					<include name="org/cesecore/authorization/control/StandardRules.java"/>
					<include name="org/cesecore/certificates/CertificateCreationException.java" />
					<include name="org/cesecore/certificates/certificate/CertificateConstants.java"/>
					<include name="org/cesecore/certificates/certificateprofile/CertificateProfileConstants.java"/>
					<include name="org/cesecore/certificates/ocsp/exception/CryptoProviderException.java"/>
					<include name="org/cesecore/certificates/util/AlgorithmConstants.java"/>					
					<include name="org/cesecore/certificates/util/DNFieldExtractor.java"/>
					<include name="org/cesecore/certificates/util/dn/DNFieldsUtil.java"/>
					<include name="org/cesecore/config/CesecoreConfiguration.java"/>
					<include name="org/cesecore/config/ConfigurationHolder.java"/>							
					<include name="org/cesecore/config/ExtendedKeyUsageConfiguration.java"/>
					<include name="org/cesecore/config/OcspConfiguration.java"/>
					<include name="org/cesecore/util/CryptoProviderTools.java"/>				
					<include name="org/cesecore/util/FileTools.java"/>
					<include name="org/cesecore/util/Base64.java"/>
					<include name="org/cesecore/util/GUIDGenerator.java"/>
					<include name="org/cesecore/util/JBossUnmarshaller.java"/>
					<include name="org/cesecore/util/QueryParameterException.java"/>
					<include name="org/cesecore/util/QueryResultWrapper.java"/>
					<include name="org/cesecore/util/SimpleTime.java"/>
					<include name="org/cesecore/util/StringTools.java"/>
					<include name="org/cesecore/util/ValueExtractor.java"/> 
					<include name="org/cesecore/util/XmlSerializer.java"/>
					<include name="org/cesecore/util/query/*.java"/>
					<include name="org/cesecore/util/query/clauses/*.java"/>
					<include name="org/cesecore/util/query/elems/*.java"/>
					<include name="org/cesecore/internal/CommonCache*.java"/>
					<include name="org/ejbca/config/DatabaseConfiguration.java"/>
					<include name="org/ejbca/config/EjbcaConfiguration.java"/>
					<include name="org/ejbca/config/EjbcaConfigurationHolder.java"/>			
					<include name="org/ejbca/config/InternalConfiguration.java"/>	
					<include name="org/ejbca/core/EjbcaException.java"/>
					<include name="org/ejbca/core/ejb/ServiceLocator.java"/>
					<include name="org/ejbca/core/ejb/ServiceLocatorException.java"/>
					<include name="org/cesecore/util/CeSecoreNameStyle.java"/>
					<include name="org/ejbca/util/JDBCUtil.java"/>			
					<!-- Dependencies from Protect that are pretty general.. -->
					<include name="org/cesecore/internal/InternalResources.java"/>
					<include name="org/ejbca/core/model/InternalEjbcaResources.java"/>
					<!-- Dependencies from Publisher and Approval that are pretty general.. -->
					<include name="org/cesecore/internal/UpgradeableDataHashMap.java"/>
					<include name="org/cesecore/internal/IUpgradeableData.java"/>
					<!-- Dependencies from Publisher that are pretty general.. -->
					<include name="org/cesecore/util/Base64GetHashMap.java"/>
					<include name="org/cesecore/util/Base64PutHashMap.java"/>
					<!-- SecConst should probably be divided into several constants classes.. -->
					<include name="org/ejbca/core/model/SecConst.java"/>
					<!-- Dependencies from CertificateData and CAToken -->					
					<include name="org/cesecore/certificates/util/AlgorithmTools.java"/>
					<include name="org/cesecore/keys/token/AvailableCryptoToken.java"/>
					<include name="org/cesecore/keys/token/*Token.java"/>
					<include name="org/cesecore/keys/token/CryptoTokenAuthenticationFailedException.java"/>
					<include name="org/cesecore/keys/token/CryptoTokenFactory.java"/>
					<include name="org/cesecore/keys/token/CryptoTokenOfflineException.java"/>
					<include name="org/cesecore/keys/token/IllegalCryptoTokenException.java"/>
					<include name="org/cesecore/keys/token/KeyRenewalFailedException.java"/>
					<include name="org/cesecore/keys/token/PrivateKeyNotExtractableException.java"/>
					<include name="org/cesecore/keys/token/p11/*.java"/>
					<include name="org/cesecore/keys/token/p11/exception/*.java"/>
					<include name="org/cesecore/keys/KeyCreationException.java"/>
					<include name="org/cesecore/keys/util/Key*.java"/>
					<include name="org/cesecore/util/CertTools.java"/>
					<!-- Dependencies from CertTools -->
					<include name="org/cesecore/certificates/crl/RevokedCertInfo.java"/>
					<include name="org/cesecore/certificates/util/DnComponents.java"/>
					<!-- Dependencies from noticifations, WS and AdminGUI -->
					<include name="org/cesecore/util/ValidityDate.java"/>
					<include name="org/cesecore/util/YearMonthDayTime.java"/>
					<include name="org/cesecore/util/UnitParser.java"/>
					<!-- Dependencies from LdapPublisher -->
					<include name="org/ejbca/util/LdapNameStyle.java"/>
            		<include name="org/ejbca/util/LdapTools.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/common" destdir="${build-temp.dir}/common" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<pathelement location="${build-temp.dir}/config"/>
					<path refid="compile-util.classpath"/>
				</classpath>
			</javac>

			<!-- AdminObjects component -->
			<echo message=" ** Validating component: AdminObjects **"/>
			<mkdir dir="${src-temp.dir}/admins"/>
			<mkdir dir="${build-temp.dir}/admins"/>
			<copy todir="${src-temp.dir}/admins">
				<fileset dir="${src.dir}">			
					<include name="org/cesecore/authentication/AuthenticationFailedException.java"/>
					<include name="org/cesecore/authentication/tokens/AuthenticationToken.java"/>
					<include name="org/cesecore/authentication/tokens/AlwaysAllowLocalAuthenticationToken.java"/>
					<include name="org/cesecore/authentication/tokens/InvalidAuthenticationTokenException.java"/>
					<include name="org/cesecore/authentication/tokens/LocalJvmOnlyAuthenticationToken.java"/>
					<include name="org/cesecore/authentication/tokens/UsernamePrincipal.java"/>
					<include name="org/cesecore/authentication/tokens/X509CertificateAuthenticationToken.java"/>
					<include name="org/cesecore/authorization/user/AccessUserAspect.java"/>
					<include name="org/cesecore/authorization/user/AccessMatchType.java"/>
					<include name="org/cesecore/authorization/user/matchvalues/AccessMatchValue.java"/>
					<include name="org/cesecore/authorization/user/matchvalues/AccessMatchValueReverseLookupRegistry.java"/>
					<include name="org/cesecore/authorization/user/matchvalues/InvalidMatchValueException.java"/>
					<include name="org/cesecore/authorization/user/matchvalues/ReverseMatchValueLookupException.java"/>
					<include name="org/cesecore/authorization/user/matchvalues/X500PrincipalAccessMatchValue.java"/>
					<include name="org/ejbca/core/model/log/Admin.java"/>
					<include name="org/ejbca/core/model/authorization/AdminInformation.java"/>				
					<include name="org/ejbca/core/ejb/authentication/cli/CliAuthenticationToken.java"/>
                    <include name="org/ejbca/core/ejb/authentication/cli/CliAuthenticationTokenReferenceRegistry.java"/>
                    <include name="org/ejbca/core/ejb/authentication/cli/CliUserAccessMatchValue.java"/>
					<include name="org/ejbca/core/ejb/authentication/cli/exception/UninitializedCliAuthenticationTokenException.java"/>
                    <include name="org/ejbca/util/crypto/BCrypt.java"/>
                    <include name="org/ejbca/util/crypto/CryptoTools.java"/>
					<include name="org/ejbca/util/crypto/SupportedPasswordHashAlgorithm.java"/>	
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/admins" destdir="${build-temp.dir}/admins" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
				</classpath>
			</javac>

			<!-- Logging component -->
			<echo message=" ** Validating component: Logging (except CsvLogExporter) **"/>
			<mkdir dir="${src-temp.dir}/logging"/>
			<mkdir dir="${build-temp.dir}/logging"/>
			<copy todir="${src-temp.dir}/logging">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/cesecore/authorization/control/AccessControlSession*.java"/>
					<include name="org/cesecore/audit/log/*.java"/>					
					<include name="org/cesecore/audit/audit/*.java"/>
					<include name="org/cesecore/audit/impl/integrityprotected/*.java"/>
					<include name="org/cesecore/audit/impl/queued/*.java"/>
					<include name="org/cesecore/time/*.java"/>
					<include name="org/ejbca/core/ejb/audit/enums/*.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/cesecore/audit/impl/integrityprotected/AuditRecordData.java"/>
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/cesecore/authorization/AuthorizationDeniedException.java"/>
					<include name="org/cesecore/audit/*.java"/>
					<include name="org/cesecore/audit/audit/*.java"/>
					<include name="org/cesecore/audit/enums/*.java"/>					
					<include name="org/cesecore/audit/impl/*.java"/>
					<include name="org/cesecore/audit/impl/integrityprotected/*.java"/>
					<include name="org/cesecore/audit/impl/queued/*.java"/>
					<include name="org/cesecore/audit/log/*.java"/>				
					<include name="org/cesecore/time/*.java"/>
					<include name="org/cesecore/time/providers/*.java"/>
					<include name="org/ejbca/core/model/log/LogConstants.java"/>
					<include name="org/ejbca/core/model/log/LogEntry.java"/>
					<include name="org/ejbca/util/query/**/*.java"/>
					<include name="org/ejbca/util/ObjectCache.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/logging" destdir="${build-temp.dir}/logging" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
				</classpath>
			</javac>

			<!-- Authorization component -->
			<echo message=" ** Validating component: Authorization **"/>
			<mkdir dir="${src-temp.dir}/authorization"/>
			<mkdir dir="${build-temp.dir}/authorization"/>
			<copy todir="${src-temp.dir}/authorization">
				<fileset dir="${src-ejbca-ejb-interface.dir}">					
					<include name="org/cesecore/authorization/user/AccessUserAspectManager*.java"/>
					<include name="org/cesecore/authorization/cache/AccessTreeUpdateSession*.java"/>
					<include name="org/cesecore/authorization/control/AccessControlSession*.java"/>
					<include name="org/cesecore/authorization/rules/AccessRuleManagementSession*.java"/>						
					<include name="org/cesecore/certificates/ca/CaSession*.java"/>	
					<include name="org/cesecore/roles/access/*.java"/>
					<include name="org/cesecore/roles/management/*.java"/>
					<include name="org/ejbca/core/ejb/authorization/ComplexAccessControlSession*.java"/>
					<include name="org/ejbca/core/ejb/config/GlobalConfigurationSession*.java"/>
					<include name="org/ejbca/core/ejb/ra/EndEntityAccess*.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">									
					<include name="org/cesecore/authorization/rules/*.java"/>
					<include name="org/cesecore/authorization/access/*.java"/>
					<include name="org/cesecore/authorization/user/*.java"/>
					<include name="org/cesecore/authorization/cache/*.java"/>
					<include name="org/cesecore/dbprotection/*.java"/>	
					<include name="org/cesecore/roles/RoleData.java"/>
				</fileset>
				<fileset dir="${src.dir}">					
					<include name="org/cesecore/authorization/cache/*.java"/>
					<include name="org/cesecore/authorization/control/*.java"/>
					<include name="org/cesecore/authorization/rules/*.java"/>
					<include name="org/cesecore/authorization/user/AccessUserAspect*Exception.java"/>
					<include name="org/cesecore/authorization/access/AccessTree*.java"/>	
					<include name="org/cesecore/certificates/ca/CA.java"/>
					<include name="org/cesecore/certificates/ca/CADoesntExistsException.java"/>
					<include name="org/cesecore/certificates/ca/CAExistsException.java"/>
					<include name="org/cesecore/certificates/ca/InvalidAlgorithmException.java"/>	
					<include name="org/cesecore/certificates/ca/CAInfo.java"/>
					<include name="org/cesecore/certificates/ca/SignRequestSignatureException.java"/>
					<include name="org/cesecore/certificates/ca/catoken/CAToken*.java"/>
					<include name="org/cesecore/certificates/ca/catoken/PurposeMapping.java"/>
					<include name="org/cesecore/certificates/ca/extendedservices/*.java"/>
					<include name="org/cesecore/certificates/ca/internal/*Manager.java"/>
					<include name="org/cesecore/certificates/ca/SignRequestException.java"/>
					<include name="org/cesecore/certificates/certificate/request/RequestMessage.java"/>
					<include name="org/cesecore/certificates/certificate/request/ResponseMessage.java"/>
					<include name="org/cesecore/certificates/certificate/request/CertificateResponseMessage.java"/>
					<include name="org/cesecore/certificates/certificate/request/ResponseStatus.java"/>
					<include name="org/cesecore/certificates/certificate/request/FailInfo.java"/>
					<include name="org/cesecore/certificates/certificateprofile/CertificateProfile.java"/>
					<include name="org/cesecore/certificates/certificateprofile/CertificatePolicy.java"/>
					<include name="org/cesecore/certificates/endentity/EndEntityConstants.java"/>
					<include name="org/cesecore/certificates/endentity/EndEntityInformation.java"/>
					<include name="org/cesecore/certificates/endentity/EndEntityType.java"/>
					<include name="org/cesecore/certificates/endentity/EndEntityTypes.java"/>
					<include name="org/cesecore/certificates/endentity/ExtendedInformation.java"/>
					<include name="org/cesecore/roles/access/*.java"/>
					<include name="org/cesecore/roles/management/*.java"/>
					<include name="org/cesecore/roles/Role*Exception.java"/>
					<include name="org/cesecore/util/ProfileID.java"/>
					<include name="org/ejbca/config/*.java"/>			
					<include name="org/ejbca/core/ejb/ra/EndEntityExistsException.java"/>
					<include name="org/ejbca/core/ejb/ra/NoSuchEndEntityException.java"/>
					<include name="org/ejbca/core/model/authorization/*.java"/>
					<include name="org/ejbca/core/model/ca/AuthLoginException.java"/>
					<include name="org/ejbca/core/model/ca/AuthStatusException.java"/>
                    <include name="org/ejbca/core/model/ra/NotFoundException*.java"/>							
					<include name="org/ejbca/util/SlotList.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/authorization" destdir="${build-temp.dir}/authorization" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
				</classpath>
			</javac>

			<!-- Notification component -->
			<echo message=" ** Validating component: Notification Base 	**"/>
			<mkdir dir="${src-temp.dir}/notification"/>
			<mkdir dir="${build-temp.dir}/notification"/>
			<copy todir="${src-temp.dir}/notification">
				<fileset dir="${src.dir}">
					<!-- Include the Mail utility and configuration as a subcomponent of Notification -->
					<include name="org/ejbca/config/MailConfiguration.java"/>
					<include name="org/ejbca/util/mail/*.java"/>
					<!-- Include the notification base components -->
					<include name="org/ejbca/util/NotificationParamGen.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/notification" destdir="${build-temp.dir}/notification" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
				</classpath>
			</javac>

			<!-- Approval component -->
			<echo message=" ** Validating component: Approval Base (excludes Approval Execution, includes GlobalConfiguration..) **"/>
			<mkdir dir="${src-temp.dir}/approval"/>
			<mkdir dir="${build-temp.dir}/approval"/>
			<copy todir="${src-temp.dir}/approval">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/ejbca/core/ejb/approval/ApprovalSession*.java"/>
					<!-- Unneeded dependency -->
					<include name="org/cesecore/certificates/certificate/CertificateStoreSession*.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/ejbca/core/ejb/approval/*.java"/>
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/ejbca/core/ejb/approval/ApprovalSessionBean.java"/>
					<include name="org/ejbca/core/model/approval/**/*.java"/>
					<include name="org/cesecore/certificates/certificate/CertificateInfo.java"/>
					<include name="org/cesecore/certificates/certificate/CertificateRevokeException.java"/>
					<include name="org/cesecore/certificates/certificate/CertificateStatus.java"/>
					<!-- GlobalConfiguration is more of RA/AdminGUI component, but is hard to get rid of w/o database changes.. -->
					<include name="org/ejbca/config/GlobalConfiguration.java"/>
					<include name="org/ejbca/config/WebConfiguration.java"/>                
					<include name="org/ejbca/util/SlotList.java"/>
					<!-- Exclude RA approval requests.. org.ejbca.core.model.ra.approvalrequests would be a better location for these -->
					<exclude name="org/ejbca/core/model/approval/approvalrequests/EditEndEntityApprovalRequest.java"/>
					<exclude name="org/ejbca/core/model/approval/approvalrequests/AddEndEntityApprovalRequest.java"/>
					<exclude name="org/ejbca/core/model/approval/ApprovalRequestHelper.java"/>
					<exclude name="org/ejbca/core/model/approval/approvalrequests/ChangeStatusEndEntityApprovalRequest.java"/>
					<exclude name="org/ejbca/core/model/approval/approvalrequests/RevocationApprovalRequest.java"/>
					<!-- CA approval requests.. org.ejbca.core.model.ca.approvalrequests would be a better location for this -->
					<exclude name="org/ejbca/core/model/approval/approvalrequests/ActivateCATokenApprovalRequest.java"/>
					<!-- Key Recovery approval requests.. org.ejbca.core.model.keyrecovery.approvalrequests would be a better location for this -->
					<exclude name="org/ejbca/core/model/approval/approvalrequests/KeyRecoveryApprovalRequest.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/approval" destdir="${build-temp.dir}/approval" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
					<pathelement location="${build-temp.dir}/authorization"/>
					<pathelement location="${build-temp.dir}/notification"/>
				</classpath>
			</javac>

			<!-- CA and Certificate Extensions component -->
					<echo message=" ** Validating component: CA and Certificate Extensions **"/>
					<mkdir dir="${src-temp.dir}/ca"/>
					<mkdir dir="${build-temp.dir}/ca"/>
					<copy todir="${src-temp.dir}/ca">
						<fileset dir="${src.dir}">
							<include name="com/novosec/pkix/asn1/crmf/*.java"/>
							<include name="org/cesecore/certificates/ca/*CA.java"/>
							<include name="org/cesecore/certificates/ca/*CAInfo.java"/>
							<include name="org/cesecore/certificates/ca/CAConstants.java"/>
							<include name="org/cesecore/certificates/ca/extendedservices/*.java"/>
							<include name="org/cesecore/certificates/ca/internal/CertificateValidity.java"/>
							<include name="org/cesecore/certificates/ca/IllegalValidityException.java"/>
							<include name="org/cesecore/certificates/ca/IllegalNameException.java"/>
							<include name="org/cesecore/certificates/ca/CAOfflineException.java"/>
							<include name="org/cesecore/certificates/ca/SignRequestSignatureException.java"/>
							<include name="org/cesecore/certificates/ca/SignRequestException.java"/>
							<include name="org/cesecore/certificates/ca/internal/SernoGenerator.java"/>
							<include name="org/cesecore/certificates/ca/internal/SernoGeneratorRandom.java"/>
							<include name="org/cesecore/certificates/certificate/HashID.java"/>						
							<include name="org/cesecore/certificates/certificate/request/RequestMessageUtils.java"/>
							<include name="org/cesecore/certificates/certificate/CertificateCreateException.java"/>
							<include name="org/cesecore/certificates/certificate/request/PKCS10RequestMessage.java"/>
							<include name="org/cesecore/certificates/certificate/request/CVCRequestMessage.java"/>
							<include name="org/cesecore/certificates/certificate/request/SimpleRequestMessage.java"/>
							<include name="org/cesecore/certificates/certificate/request/RequestMessage.java"/>
							<include name="org/cesecore/certificates/certificate/request/ResponseMessage.java"/>
							<include name="org/cesecore/certificates/certificate/request/CertificateResponseMessage.java"/>
							<include name="org/cesecore/certificates/certificate/request/ResponseStatus.java"/>
							<include name="org/cesecore/certificates/certificate/request/FailInfo.java"/>
							<include name="org/cesecore/certificates/util/dn/PrintableStringEntryConverter.java"/>
							<include name="org/cesecore/util/SimpleTime.java"/>
							<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/BaseSigningCAServiceInfo.java"/>
							<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/ExtendedCAServiceTypes.java"/>
							<!-- Dependency on Certificate Extensions -->					
							<include name="org/cesecore/certificates/certificate/certextensions/standard/*.java"/>
							<include name="org/cesecore/certificates/certificate/certextensions/*.java"/>
							<include name="org/cesecore/certificates/util/cert/SubjectDirAttrExtension.java"/>
							<!-- OCSPCAService dependencies that maybe shouldn't be here.. -->
							<include name="org/cesecore/config/OcspConfiguration.java"/>
							<include name="org/cesecore/certificates/ocsp/SHA1DigestCalculator.java"/>
							<include name="org/cesecore/certificates/ocsp/exception/NotSupportedException.java"/>
							<include name="org/cesecore/certificates/ocsp/exception/OcspFailureException.java"/>													
							<!-- End Entity classes .. -->
							<include name="org/cesecore/certificates/endentity/EndEntityConstants.java"/>
							<include name="org/cesecore/certificates/endentity/ExtendedInformation.java"/>
							<include name="org/cesecore/certificates/endentity/EndEntityInformation.java"/>
							<include name="org/cesecore/certificates/util/dn/DNFieldsUtil.java"/>
							<include name="org/cesecore/certificates/util/dn/DNFields.java"/>
						</fileset>
					</copy>
					<javac srcdir="${src-temp.dir}/ca" destdir="${build-temp.dir}/ca" debug="on" includeantruntime="no"
		        	encoding="UTF-8" target="${java.target.version}">
						<classpath>
							<path refid="compile-util.classpath"/>
							<pathelement location="${build-temp.dir}/common"/>
							<pathelement location="${build-temp.dir}/certprof"/>
							<pathelement location="${build-temp.dir}/catoken"/>
							<pathelement location="${build-temp.dir}/admins"/>
							<pathelement location="${build-temp.dir}/authorization"/>
						</classpath>
					</javac>
			
			<!-- Publish component -->
			<echo message=" ** Validating component: Publish **"/>
			<mkdir dir="${src-temp.dir}/publish"/>
			<mkdir dir="${build-temp.dir}/publish"/>
			<copy todir="${src-temp.dir}/publish">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/ejbca/core/ejb/ca/publisher/*.java"/>					
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/ejbca/core/ejb/ca/publisher/*.java"/>
					<!-- Unwanted dependecies.. -->
					<include name="org/cesecore/certificates/crl/CRLData.java"/>
					<include name="org/cesecore/certificates/certificate/CertificateData.java"/>
					<include name="org/cesecore/certificates/certificate/Base64CertData.java"/>
				</fileset>
				<fileset dir="${src.dir}">				
					<include name="org/cesecore/certificates/certificate/CertificateInfo.java"/>			
					<include name="org/ejbca/core/ejb/ca/publisher/PublisherQueueSessionBean.java"/>
					<include name="org/ejbca/core/model/ca/publisher/*.java"/>
					<!-- Use by the LDAP Publisher -->
					<include name="org/ejbca/util/TCPTool.java"/>
					<!-- RA classes that maybe shouldn't be here.. -->
					<include name="org/ejbca/core/model/ra/UserDataVO.java"/>
					<include name="org/ejbca/core/model/ra/ExtendedInformation.java"/>
					<include name="org/cesecore/certificates/endentity/ExtendedInformation.java"/>
					<include name="org/cesecore/certificates/util/dn/DNFieldsUtil.java"/>
					<include name="org/cesecore/certificates/util/dn/DNFields.java"/>
					<!-- Uses ExternalOCSPPublisher -->
					<exclude name="org/ejbca/core/ejb/ca/publisher/PublisherSessionBean.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/publish" destdir="${build-temp.dir}/publish" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
					<pathelement location="${build-temp.dir}/authorization"/>
				</classpath>
			</javac>

			<!-- Certificate History component -->
			<echo message=" ** Validating component: Certificate History **"/>
			<mkdir dir="${src-temp.dir}/certhist"/>
			<mkdir dir="${build-temp.dir}/certhist"/>
			<copy todir="${src-temp.dir}/certhist">
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/ejbca/core/ejb/ca/store/CertReqHistoryData.java"/>
	    			<include name="org/ejbca/util/FixEndOfBrokenXML.java"/>
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/ejbca/core/model/ca/store/CertReqHistory*.java"/>
					<!-- RA classes that maybe shouldn't be here.. -->
					<include name="org/cesecore/certificates/endentity/EndEntityInformation.java"/>
					<include name="org/cesecore/certificates/endentity/EndEntityType.java"/>
					<include name="org/cesecore/certificates/endentity/EndEntityTypes.java"/>
					<include name="org/cesecore/certificates/endentity/ExtendedInformation.java"/>
					<include name="org/cesecore/certificates/endentity/EndEntityConstants.java"/>
					<include name="org/cesecore/certificates/util/dn/DNFieldsUtil.java"/>
					<include name="org/cesecore/certificates/util/dn/DNFields.java"/>
					<include name="org/ejbca/core/model/ra/UserDataVO.java"/>
					<include name="org/ejbca/core/model/ra/ExtendedInformation.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/certhist" destdir="${build-temp.dir}/certhist" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
				</classpath>
			</javac>

			<!-- Certificate Profile component -->
			<echo message=" ** Validating component: Certificate Profile **"/>
			<mkdir dir="${src-temp.dir}/certprof"/>
			<mkdir dir="${build-temp.dir}/certprof"/>
			<copy todir="${src-temp.dir}/certprof">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/cesecore/certificates/certificateprofile/*.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/cesecore/certificates/certificateprofile/CertificateProfileData.java"/>
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/cesecore/certificates/certificateprofile/*.java"/>
					<include name="org/cesecore/config/ExtendedKeyUsageConfiguration.java"/>
					<include name="org/cesecore/util/ProfileID.java"/>					
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/certprof" destdir="${build-temp.dir}/certprof" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
				</classpath>
			</javac>

			<!-- Certificate Storage component -->
			<echo message=" ** Validating component: Certificate Storage **"/>
			<mkdir dir="${src-temp.dir}/certstore"/>
			<mkdir dir="${build-temp.dir}/certstore"/>
			<copy todir="${src-temp.dir}/certstore">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/cesecore/certificates/certificate/Certificate*Session*.java"/>
					<include name="org/ejbca/core/ejb/ca/store/*.java"/>
					<include name="org/cesecore/keys/token/CryptoTokenManagementSession*.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">					
					<include name="org/cesecore/core/ejb/ca/store/*.java"/>
				</fileset>
				<fileset dir="${src.dir}">
					<include name="com/novosec/pkix/asn1/crmf/*.java"/>
					<include name="org/cesecore/certificates/certificate/*.java"/>
					<include name="org/cesecore/certificates/certificate/request/*.java"/>
					<include name="org/cesecore/certificates/ca/SignRequestException.java"/>
					<!-- Required by external OCSP's LocalCertificateStoreOnlyDataSessionBean -->
					<include name="org/cesecore/certificates/ca/CAConstants.java"/>					
					<include name="org/ejbca/core/ejb/ca/store/CertreqHistorySessionBean.java"/>										
					<include name="org/ejbca/core/model/ca/store/CertReqHistory*.java"/>
					<include name="org/cesecore/keys/token/KeyPairInfo.java"/>
					<include name="org/cesecore/keys/token/CryptoTokenInfo.java"/>
					<include name="org/cesecore/keys/token/CryptoTokenNameInUseException.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/certstore" destdir="${build-temp.dir}/certstore" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
					<pathelement location="${build-temp.dir}/authorization"/>
					<pathelement location="${build-temp.dir}/notification"/>
					<pathelement location="${build-temp.dir}/publish"/>
					<pathelement location="${build-temp.dir}/certhist"/>
					<pathelement location="${build-temp.dir}/certprof"/>
				</classpath>
			</javac>

		

			<!-- CA Admin component -->
			<echo message=" ** Validating component: CA Admin (Excluding CAAdminSessionBean!) **" />
			<mkdir dir="${src-temp.dir}/caadmin" />
			<mkdir dir="${build-temp.dir}/caadmin" />
			<copy todir="${src-temp.dir}/caadmin">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/cesecore/certificates/ca/Session*.java" />
					<include name="org/cesecore/keys/token/CryptoTokenSession*.java" />
					<include name="org/ejbca/core/ejb/ca/caadmin/*Session*.java" />
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/cesecore/certificates/ca/CAData.java" />
				</fileset>
				<fileset dir="${src.dir}">
					<!-- Depends on things that depends in Ejb*Helper
				    			<include name="org/ejbca/core/ejb/ca/caadmin/CAAdminSessionBean.java"/>
				    			-->		
					<include name="org/ejbca/core/model/ca/caadmin/*.java" />
					<include name="org/cesecore/certificates/certificate/request/X509ResponseMessage.java" />
					<!-- Depends on EjbRemoteHelper and EjbLocalHelper -->					
					<exclude name="org/ejbca/core/model/approval/approvalrequests/ActivateCATokenApprovalRequest.java" />
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/caadmin" destdir="${build-temp.dir}/caadmin" debug="on" includeantruntime="no" encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath" />
					<pathelement location="${build-temp.dir}/common" />
					<pathelement location="${build-temp.dir}/admins" />
					<pathelement location="${build-temp.dir}/ca" />
					<pathelement location="${build-temp.dir}/logging" />
					<pathelement location="${build-temp.dir}/authorization" />
					<pathelement location="${build-temp.dir}/catoken" />
					<pathelement location="${build-temp.dir}/certstore" />
					<pathelement location="${build-temp.dir}/certprof" />
					<pathelement location="${build-temp.dir}/approval" />
					<pathelement location="${build-temp.dir}/publish" />
				</classpath>
			</javac>

			<!-- CRL component -->
			<echo message=" ** Validating component: CRL **" />
			<mkdir dir="${src-temp.dir}/crl" />
			<mkdir dir="${build-temp.dir}/crl" />
			<copy todir="${src-temp.dir}/crl">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/cesecore/certificates/crl/Crl*Session*.java"/>
					<include name="org/ejbca/core/ejb/crl/PublishingCrlSession*.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/cesecore/certificates/crl/CRLData.java"/>
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/cesecore/certificates/ca/CAOfflineException.java"/>
					<include name="org/cesecore/certificates/ca/CAConstants.java"/>	
					<include name="org/cesecore/certificates/ca/X509CAInfo.java"/>
					<include name="org/cesecore/certificates/crl/*.java"/>
					<include name="org/ejbca/core/ejb/crl/PublishingCrlSessionBean.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/crl" destdir="${build-temp.dir}/crl" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/ca"/>
					<pathelement location="${build-temp.dir}/caadmin"/>
					<pathelement location="${build-temp.dir}/logging"/>
					<pathelement location="${build-temp.dir}/authorization"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/catoken"/>
					<pathelement location="${build-temp.dir}/certstore"/>
					<pathelement location="${build-temp.dir}/publish"/>
				</classpath>
			</javac>

			<!-- Signing component -->
			<echo message=" ** Validating component: Signing **"/>
			<mkdir dir="${src-temp.dir}/signing"/>
			<mkdir dir="${build-temp.dir}/signing"/>
			<copy todir="${src-temp.dir}/signing">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/ejbca/core/ejb/ca/sign/*.java"/>
					<!-- Authentication dependency (unwanted.. depends on RA..) -->
					<include name="org/cesecore/certificates/certificate/CertificateCreateSession*.java"/>
					<include name="org/ejbca/core/ejb/ca/auth/EndEntityAuthenticationSessionLocal.java"/>
					<include name="org/ejbca/core/ejb/ca/auth/EndEntityAuthenticationSession.java"/>
					<include name="org/ejbca/core/ejb/ra/EndEntityManagementSessionLocal.java"/>
					<include name="org/ejbca/core/ejb/ra/EndEntityManagementSession.java"/>				
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/cesecore/certificates/certificate/UniqueSernoHelper.java"/>
					<include name="org/cesecore/certificates/certificate/IllegalKeyException.java"/>
					<include name="org/cesecore/certificates/certificate/CustomCertSerialNumberException.java"/>
					<include name="org/ejbca/core/ejb/ca/sign/*SessionBean.java"/>
					<include name="org/ejbca/core/ejb/ca/sign/*Helper.java"/>
					<include name="org/ejbca/core/model/ca/sign/SignSessionBean.java"/>				
					<!-- Authentication dependency (unwanted.. depends on RA..) -->
					<include name="org/cesecore/certificates/certificate/CertificateCreateException.java"/>
					<include name="org/cesecore/certificates/certificate/CertificateCreateSessionBean.java"/>
					<include name="org/ejbca/core/model/ca/AuthStatusException.java"/>
					<include name="org/ejbca/core/model/ca/AuthLoginException.java"/>
					<include name="org/ejbca/core/model/ra/raadmin/UserDoesntFullfillEndEntityProfile.java"/>
					<include name="org/ejbca/core/model/ra/AlreadyRevokedException.java"/>
					<include name="org/ejbca/core/model/ra/RevokeBackDateNotAllowedForProfileException.java"/>
					<include name="org/cesecore/certificates/endentity/EndEntityConstants.java"/>
					<include name="org/ejbca/util/crypto/BCrypt.java"/>
					<include name="org/ejbca/util/crypto/CryptoTools.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<!-- Authentication dependency (unwanted.. depends on RA..) -->
					<include name="org/ejbca/core/ejb/ra/UserData.java"/>
					<include name="org/ejbca/core/ejb/ra/BCrypt.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/signing" destdir="${build-temp.dir}/signing" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
					<pathelement location="${build-temp.dir}/authorization"/>
					<pathelement location="${build-temp.dir}/notification"/>
					<pathelement location="${build-temp.dir}/approval"/>
					<pathelement location="${build-temp.dir}/publish"/>
					<pathelement location="${build-temp.dir}/certprof"/>
					<pathelement location="${build-temp.dir}/certstore"/>
					<pathelement location="${build-temp.dir}/catoken"/>
					<pathelement location="${build-temp.dir}/ca"/>
					<pathelement location="${build-temp.dir}/caadmin"/>
					<pathelement location="${build-temp.dir}/crl"/>
				</classpath>
			</javac>

			<!-- OCSP component -->
			<echo message=" ** Validating component: OCSP **"/>
			<mkdir dir="${src-temp.dir}/ocsp"/>
			<mkdir dir="${build-temp.dir}/ocsp"/>
			<copy todir="${src-temp.dir}/ocsp">
				<fileset dir="${src.dir}">
					<include name="org/cesecore/config/OcspConfiguration.java"/>
					<include name="org/ejbca/util/IPatternLogger.java"/>
					<include name="org/ejbca/util/PatternLogger.java"/>
					<include name="org/ejbca/core/protocol/ocsp/*.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/ocsp" destdir="${build-temp.dir}/ocsp" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/certstore"/>
					<pathelement location="${build-temp.dir}/ca"/>
				</classpath>
			</javac>

			<!-- User Data Source component... -->
			<echo message=" ** Validating component: User Data Source **"/>
			<mkdir dir="${src-temp.dir}/userdatasource"/>
			<mkdir dir="${build-temp.dir}/userdatasource"/>
			<copy todir="${src-temp.dir}/userdatasource">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/ejbca/core/ejb/ra/userdatasource/*.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/ejbca/core/ejb/ra/userdatasource/UserDataSourceData.java"/>
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/ejbca/core/ejb/ra/userdatasource/*SessionBean.java"/>
					<include name="org/ejbca/core/model/ra/userdatasource/**/*.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/userdatasource" destdir="${build-temp.dir}/userdatasource" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/ca"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
					<pathelement location="${build-temp.dir}/authorization"/>
					<pathelement location="${build-temp.dir}/caadmin"/>
				</classpath>
			</javac>

			<!-- Key Recovery component -->
			<echo message=" ** Validating component: Key Recovery (Excluding LocalKeyRecoverySessionBean!) **"/>
			<mkdir dir="${src-temp.dir}/keyrecovery"/>
			<mkdir dir="${build-temp.dir}/keyrecovery"/>
			<copy todir="${src-temp.dir}/keyrecovery">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/ejbca/core/ejb/keyrecovery/*.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/ejbca/core/ejb/keyrecovery/*.java"/>
				</fileset>
				<fileset dir="${src.dir}">
					<!-- Depends on KeyRecoveryApprovalRequest that depends on EjbLocalHelper
    			<include name="org/ejbca/core/ejb/keyrecovery/*SessionBean.java"/>
    			-->
					<include name="org/ejbca/core/model/keyrecovery/**/*.java"/>
					<!-- Depends on EjbLocalHelper (Undesired dependency on User Administration) -->
					<exclude name="org/ejbca/core/model/approval/approvalrequests/KeyRecoveryApprovalRequest.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/keyrecovery" destdir="${build-temp.dir}/keyrecovery" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/caadmin"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
					<pathelement location="${build-temp.dir}/authorization"/>
					<pathelement location="${build-temp.dir}/approval"/>
					<pathelement location="${build-temp.dir}/ca"/>
					<pathelement location="${build-temp.dir}/certstore"/>
					<pathelement location="${build-temp.dir}/signing"/>
				</classpath>
			</javac>

			<!-- RA Administration component -->
			<echo message=" ** Validating component: RA Administration **"/>
			<mkdir dir="${src-temp.dir}/raadmin"/>
			<mkdir dir="${build-temp.dir}/raadmin"/>
			<copy todir="${src-temp.dir}/raadmin">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/ejbca/core/ejb/ra/raadmin/*.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/ejbca/core/ejb/ra/raadmin/*.java"/>
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/cesecore/certificates/endentity/EndEntityConstants.java"/>
					<include name="org/cesecore/certificates/endentity/EndEntityInformation.java"/>
					<include name="org/cesecore/certificates/endentity/ExtendedInformation.java"/>
					<include name="org/ejbca/core/ejb/ra/raadmin/*SessionBean.java"/>
					<include name="org/ejbca/core/ejb/ra/raadmin/*Cache.java"/>
					<include name="org/ejbca/core/model/ra/raadmin/**/*.java"/>
					<include name="org/ejbca/util/passgen/*.java"/>
					<include name="org/ejbca/core/model/ra/ExtendedInformationFields.java"/>			
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/raadmin" destdir="${build-temp.dir}/raadmin" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/caadmin"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
					<pathelement location="${build-temp.dir}/authorization"/>
					<pathelement location="${build-temp.dir}/approval"/>
					<pathelement location="${build-temp.dir}/ca"/>
					<pathelement location="${build-temp.dir}/certstore"/>
					<pathelement location="${build-temp.dir}/signing"/>
				</classpath>
			</javac>

			<!-- Hard Token component -->
			<echo message=" ** Validating component: Hard Token **"/>
			<mkdir dir="${src-temp.dir}/hardtoken"/>
			<mkdir dir="${build-temp.dir}/hardtoken"/>
			<copy todir="${src-temp.dir}/hardtoken">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/ejbca/core/ejb/hardtoken/*.java"/>
					<include name="org/ejbca/core/ejb/config/*.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/ejbca/core/ejb/hardtoken/*.java"/>
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/ejbca/core/ejb/hardtoken/*SessionBean.java"/>
					<include name="org/ejbca/core/model/hardtoken/**/*.java"/>
					<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/HardTokenEncryptCAService*.java"/>
					<include name="org/ejbca/core/model/ra/EndEntityManagementConstants.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/hardtoken" destdir="${build-temp.dir}/hardtoken" debug="on" includeantruntime="no" encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/certprof"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/caadmin"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
					<pathelement location="${build-temp.dir}/authorization"/>
					<pathelement location="${build-temp.dir}/approval"/>
					<pathelement location="${build-temp.dir}/ca"/>
					<pathelement location="${build-temp.dir}/certstore"/>
					<pathelement location="${build-temp.dir}/signing"/>
					<pathelement location="${build-temp.dir}/raadmin"/>
				</classpath>
			</javac>

			<!-- CVS Log Exporter component -->
			<echo message=" ** SKIPPING: Validating component: CVS Log Exporter (single class, that is really a unwanted dependency from Logging) **"/>
			<!-- Depends on EjbLocalHelper
    	<mkdir dir="${src-temp.dir}/csvlogexp"/>
    	<mkdir dir="${build-temp.dir}/csvlogexp"/>
    	<copy todir="${src-temp.dir}/csvlogexp">
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/model/log/CsvLogExporter.java"/>
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/csvlogexp" destdir="${build-temp.dir}/csvlogexp" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
        	<classpath>
        		<path refid="compile-util.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
        		<pathelement location="${build-temp.dir}/caadmin"/>
        		<pathelement location="${build-temp.dir}/signing"/>
        		<pathelement location="${build-temp.dir}/ca"/>
        		<pathelement location="${build-temp.dir}/logging"/>
        	</classpath>
        </javac>
         -->

			<!-- User Administration and Authentication component -->
			<!-- The authentication dependecy comes from the use of ApprovalExecutorUtil.. it might not be the best way to do this..
    		 The RA interface dependecy is from the way we present information about an approval. It should probably be parse
    		 general information better in the new Admin GUI for EJBCA 4.1. 
    	-->
			<echo message=" ** Validating component: End Entity Administration and Authentication (Excluding a lot..) **"/>
			<mkdir dir="${src-temp.dir}/endentityadmin"/>
			<mkdir dir="${build-temp.dir}/endentityadmin"/>
			<copy todir="${src-temp.dir}/endentityadmin">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/ejbca/core/ejb/ra/*.java"/>
					<include name="org/ejbca/core/ejb/ca/auth/*.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/ejbca/core/ejb/ra/*.java"/>
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/ejbca/core/model/ra/*.java"/>
					<!-- Depends on EjbLocalHelper 
    			<include name="org/ejbca/core/model/approval/ApprovalRequestHelper.java"/>
    			<include name="org/ejbca/core/model/approval/approvalrequests/EditEndEntityApprovalRequest.java"/>
    			<include name="org/ejbca/core/model/approval/approvalrequests/AddEndEntityApprovalRequest.java"/>
    			<include name="org/ejbca/core/model/approval/approvalrequests/RevocationApprovalRequest.java"/>
    			<include name="org/ejbca/core/model/approval/approvalrequests/ChangeStatusEndEntityApprovalRequest.java"/>
    			-->
					<include name="org/ejbca/util/PrinterManager.java"/>
					<include name="org/ejbca/util/dn/DistinguishedName.java"/>
					<!-- Undesired dependency on RA Interface -->
					<include name="org/ejbca/ui/web/admin/rainterface/RevokedInfoView.java"/>
					<!-- Undesired circular dependency on Authentication ? -->
					<include name="org/ejbca/core/model/ca/auth/*.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/endentityadmin" destdir="${build-temp.dir}/endentityadmin" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/caadmin"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
					<pathelement location="${build-temp.dir}/authorization"/>
					<pathelement location="${build-temp.dir}/approval"/>
					<pathelement location="${build-temp.dir}/ca"/>
					<pathelement location="${build-temp.dir}/certstore"/>
					<pathelement location="${build-temp.dir}/certprof"/>
					<pathelement location="${build-temp.dir}/signing"/>
					<pathelement location="${build-temp.dir}/raadmin"/>
					<pathelement location="${build-temp.dir}/keyrecovery"/>
					<pathelement location="${build-temp.dir}/notification"/>
					<pathelement location="${build-temp.dir}/hardtoken"/>
				</classpath>
			</javac>

			<!-- Services component -->
			<echo message=" ** Validating component: Services (Excluding a lot!) **"/>
			<mkdir dir="${src-temp.dir}/services"/>
			<mkdir dir="${build-temp.dir}/services"/>
			<copy todir="${src-temp.dir}/services">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/ejbca/core/ejb/services/*.java"/>
					<include name="org/ejbca/core/ejb/authentication/web/WebAuthenticationProviderSessionLocal.java"/>				
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/ejbca/core/ejb/services/*.java"/>
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/ejbca/core/ejb/services/*SessionBean.java"/>
					<include name="org/ejbca/core/model/services/BaseWorker.java"/>
					<include name="org/ejbca/core/model/services/BaseInterval.java"/>
					<include name="org/ejbca/core/model/services/I*.java"/>
					<include name="org/ejbca/core/model/services/ServiceConfiguration.java"/>
					<include name="org/ejbca/core/model/services/*Exception.java"/>
					<include name="org/ejbca/core/model/services/ActionInfo.java"/>
					<include name="org/ejbca/core/model/services/intervals/DummyInterval.java"/>				
					<!-- Depends on EjbLocalHelper
       			<include name="org/ejbca/core/model/services/*.java"/>
    			<include name="org/ejbca/core/model/services/actions/*.java"/>
    			<include name="org/ejbca/core/model/services/intervals/*.java"/>
    			-->
					<include name="org/ejbca/core/model/services/workers/EmailSendingWorkerConstants.java"/>
					<include name="org/cesecore/authentication/tokens/*.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/services" destdir="${build-temp.dir}/services" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/logging"/>
					<pathelement location="${build-temp.dir}/authorization"/>
					<pathelement location="${build-temp.dir}/notification"/>
					<pathelement location="${build-temp.dir}/crl"/>
					<pathelement location="${build-temp.dir}/certstore"/>
					<pathelement location="${build-temp.dir}/endentityadmin"/>
					<pathelement location="${build-temp.dir}/raadmin"/>
					<pathelement location="${build-temp.dir}/signing"/>
					<pathelement location="${build-temp.dir}/raadmin"/>
					<pathelement location="${build-temp.dir}/keyrecovery"/>
					<pathelement location="${build-temp.dir}/hardtoken"/>
					<pathelement location="${build-temp.dir}/approval"/>
					<pathelement location="${build-temp.dir}/publish"/>
					<pathelement location="${build-temp.dir}/caadmin"/>
					<pathelement location="${build-temp.dir}/certprof"/>
				</classpath>
			</javac>

			<!-- Upgrade component -->
			<echo message=" ** Validating component: Upgrade **"/>
			<mkdir dir="${src-temp.dir}/upgrade"/>
			<mkdir dir="${build-temp.dir}/upgrade"/>
			<copy todir="${src-temp.dir}/upgrade">
				<fileset dir="${src-ejbca-ejb-interface.dir}">
					<include name="org/ejbca/core/ejb/upgrade/*.java"/>
					<include name="org/ejbca/core/ejb/ca/publisher/PublisherSession*.java"/>
				</fileset>
				<fileset dir="${src-ejbca-entity.dir}">
					<include name="org/ejbca/core/ejb/upgrade/*.java"/>
				    <include name="org/cesecore/certificates/ca/*.java"/>                    
				</fileset>
				<fileset dir="${this.dir}/../edition-specific/src-interface">
					<include name="org/ejbca/core/ejb/EnterpriseEditionEjbBridgeSessionLocal.java" />
				</fileset>
				<fileset dir="${src.dir}">
					<include name="org/ejbca/core/ejb/upgrade/*SessionBean.java"/>
					<include name="org/ejbca/util/SqlExecutor.java"/>
					<!-- Upgrade of extended CA services in EJBCA 5.0 -->
					<include name="org/cesecore/config/*Configuration.java"/>
					<include name="org/cesecore/certificates/certificate/HashID.java"/>						
					<include name="org/cesecore/certificates/ocsp/exception/*Exception.java"/>
					<include name="org/cesecore/certificates/ocsp/SHA1DigestCalculator.java"/>
					<include name="org/ejbca/core/model/ca/caadmin/extendedcaservices/*CAService*.java"/>
					<include name="org/ejbca/config/*Configuration.java"/>
					<!-- upgrade of CertificatePolicy, change from ejbca to cesecore class -->
					<include name="org/ejbca/core/model/ca/certificateprofiles/CertificatePolicy.java"/>					
				    <include name="org/cesecore/certificates/ca/internal/*.java"/>                    
				    <include name="org/cesecore/certificates/certificate/certextensions/**/*.java"/>                    
                    <include name="org/cesecore/certificates/ca/*.java"/>                    
				    <include name="org/cesecore/certificates/util/cert/*.java"/>                    
                    <include name="org/cesecore/certificates/util/dn/*.java"/>        
					<!-- upgrade of Va Publisher-->
					<include name="org/ejbca/core/model/ca/publisher/BasePublisher.java"/>  
					<include name="org/ejbca/core/model/ca/publisher/upgrade/BasePublisherConverter.java"/>  
					<include name="org/ejbca/core/model/ca/publisher/FullEntityPublisher.java"/>  
					<include name="org/ejbca/core/model/ca/publisher/Publisher*Exception.java"/>  
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/upgrade" destdir="${build-temp.dir}/upgrade" debug="on" includeantruntime="no" encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/approval"/>
					<pathelement location="${build-temp.dir}/caadmin"/>
					<pathelement location="${build-temp.dir}/endentityadmin"/>
					<pathelement location="${build-temp.dir}/authorization"/>
					<pathelement location="${build-temp.dir}/certstore"/>
					<pathelement location="${build-temp.dir}/services"/>
					<pathelement location="${build-temp.dir}/certprof"/>
					<pathelement location="${build-temp.dir}/hardtoken"/>
					<pathelement location="${build-temp.dir}/logging"/>
					<pathelement location="${build-temp.dir}/raadmin"/>
					<!-- Since Upgrade depends on all other components we can add more here later without bother..
        		<pathelement location="${build-temp.dir}/..."/>
        		-->
				</classpath>
			</javac>

			<!-- CMP component -->
			<echo message=" ** SKIPPING: Validating component: CMP **"/>
			<!--
    	<mkdir dir="${src-temp.dir}/cmp"/>
    	<mkdir dir="${build-temp.dir}/cmp"/>
    	<copy todir="${src-temp.dir}/cmp">
    		<fileset dir="${src.dir}">
    			<include name="org/ejbca/core/protocol/cmp/*.java"/>
    			<include name="org/ejbca/config/CmpConfiguration.java"/>
    			<include name="com/novosec/pkix/**/*.java"/>
    			<!- - Depends on quickserver lib.. not sure this inclusion is useful..
    			<include name="org/ejbca/ui/tcp/Cmp*.java"/>
    			- ->
    		</fileset>
    	</copy>
        <javac srcdir="${src-temp.dir}/cmp" destdir="${build-temp.dir}/cmp" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
        	<classpath>
        		<path refid="compile-util.classpath"/>
        		<pathelement location="${build-temp.dir}/common"/>
				<pathelement location="${build-temp.dir}/ca"/>
				<pathelement location="${build-temp.dir}/caadmin"/>
				<pathelement location="${build-temp.dir}/raadmin"/>
				<pathelement location="${build-temp.dir}/endentityadmin"/>
        		<pathelement location="${build-temp.dir}/signing"/>
        		<pathelement location="${build-temp.dir}/admins"/>
        		<pathelement location="${build-temp.dir}/approval"/>
        		<pathelement location="${build-temp.dir}/certstore"/>
        		<pathelement location="${build-temp.dir}/authorization"/>
        	</classpath>
        </javac>
    	-->

			<!-- SCEP Base component -->
			<echo message=" ** Validating component: SCEP Base **"/>
			<mkdir dir="${src-temp.dir}/scep"/>
			<mkdir dir="${build-temp.dir}/scep"/>
			<copy todir="${src-temp.dir}/scep">
				<fileset dir="${src.dir}">
					<include name="org/ejbca/core/protocol/scep/*.java"/>
					<include name="org/ejbca/ui/web/protocol/Scep*.java"/>
					<!-- Servlet dependency -->
					<include name="org/ejbca/ui/web/CertificateRequestResponse.java"/>
					<include name="org/ejbca/ui/web/CertificateResponseType.java"/>
					<include name="org/ejbca/ui/web/RequestHelper.java"/>
					<include name="org/ejbca/ui/web/pub/ServletDebug.java"/>
					<include name="org/ejbca/ui/web/pub/ServletUtils.java"/>
					<include name="org/ejbca/config/WebConfiguration.java"/>
					<include name="org/ejbca/util/SlotList.java"/>
					<include name="org/cesecore/authorization/AuthorizationDeniedException.java"/>
				</fileset>
			</copy>
			<javac srcdir="${src-temp.dir}/scep" destdir="${build-temp.dir}/scep" debug="on" includeantruntime="no"
        	encoding="UTF-8" target="${java.target.version}">
				<classpath>
					<path refid="compile-util.classpath"/>
					<pathelement location="${build-temp.dir}/common"/>
					<pathelement location="${build-temp.dir}/admins"/>
					<pathelement location="${build-temp.dir}/ca"/>
					<pathelement location="${build-temp.dir}/caadmin"/>
					<pathelement location="${build-temp.dir}/catoken"/>
					<pathelement location="${build-temp.dir}/signing"/>
					<pathelement location="${build-temp.dir}/authorization"/>
				</classpath>
			</javac>

		</target>

	</project>
